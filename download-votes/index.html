<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />

    <!-- Bootstrap CSS -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
      integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2"
      crossorigin="anonymous"
    />

    <!-- Stellar SDK -->

    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/stellar-sdk/7.0.0/stellar-sdk.min.js"
      integrity="sha512-AGpfxQX0hj6dYqSjSzRs9MosacqUTDHlVT4Ym0RiCbFHIMWXKsUrGq2C4yrF04fMzq3C73VxNZNOUbqxqr0pOg=="
      crossorigin="anonymous"
    ></script>
    <script>
      console.log(StellarSdk);
    </script>

    <!-- crypto.js -->
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"
      integrity="sha512-nOQuvD9nKirvxDdvQ9OMqe2dgapbPB7vYAMrzJihw5m+aNcf0dX53m6YxM4LgA9u8e9eg9QX+/+mPu8kCNpV2A=="
      crossorigin="anonymous"
    ></script>

    <!-- URI.js -->

    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/URI.js/1.19.2/URI.min.js"
      integrity="sha512-YQAqeLT4VuAZV80lmk6OE3XtmMW3eDxUtNf2V2w16eypX21CDtelaVsFD1QLUBCQuJEenK3jPqYPmpNUasdktA=="
      crossorigin="anonymous"
    ></script>

    <!-- axios -->

    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.0/axios.min.js"
      integrity="sha512-DZqqY3PiOvTP9HkjIWgjO6ouCbq+dxqWoJZ/Q+zPYNHmlnI2dQnbJ5bxAHpAMw+LXRm4D72EIRXzvcHQtE8/VQ=="
      crossorigin="anonymous"
    ></script>

    <!-- QR code generator -->

    <script
      src="https://cdn.jsdelivr.net/npm/davidshimjs-qrcodejs@0.0.2/qrcode.min.js"
      integrity="sha256-xUHvBjJ4hahBW8qN9gceFBibSFUzbe9PNttUvehITzY="
      crossorigin="anonymous"
    ></script>

    <!-- My scripts -->

    <script>
      axios
        .get(
          "https://expand-url-jhrespicio.herokuapp.com/?as=https://bit.ly/33M05zf"
        )
        .then(function (response) {
          // handle success
          console.log(response);
        });

      async function downloadVotes() {
        var server = new StellarSdk.Server(
          "https://horizon-testnet.stellar.org"
        );

        var callback = function (resp) {
          console.log(resp);

          console.log(
            resp.created_at,
            resp.from,
            resp.to,
            resp._links.transaction.href
          );

          axios
            .get(resp._links.transaction.href)
            .then(function (response) {
              // handle success
              console.log(response);
              console.log(response.data.memo);

              axios.get(response.data.memo).then(function (response) {
                // handle success
                console.log(response);

                var resGet =
                  "https://expand-url-jhrespicio.herokuapp.com/?as=" +
                  String(response);

                axios.get(resGet).then(function (resGet) {
                  // handle success
                  console.log(response);
                });
              });
            })
            .catch(function (error) {
              // handle error
              console.log(error);
            });
        };

        var es = server
          .payments()
          .forAccount(document.getElementById("publicKey").value)

          .stream({ onmessage: callback });
      }
    </script>

    <title>IIS - Download votes</title>
  </head>

  <body>
     

    <ul class="nav">
      <li class="nav-item">
        <a
          class="nav-link"
          href="https://jhrespicio.github.io/IIS/create-an-account/"
          >Create an account</a
        >
      </li>
      <li class="nav-item">
        <a
          class="nav-link"
          href="https://jhrespicio.github.io/IIS/request-credentials/"
          >Request credentials</a
        >
      </li>

      <li class="nav-item">
        <a
          class="nav-link"
          href="https://jhrespicio.github.io/IIS/certify-credentials/"
          >Certify credentials</a
        >
      </li>

      <li class="nav-item">
        <a
          class="nav-link"
          href="https://jhrespicio.github.io/IIS/verify-credentials/"
          >Verify credentials</a
        >
      </li>

      <li class="nav-item">
        <a class="nav-link" href="https://jhrespicio.github.io/IIS/merge-links/"
          >Merge links</a
        >
      </li>

      <li class="nav-item">
        <a class="nav-link" href="https://jhrespicio.github.io/IIS/vote/"
          >Vote</a
        >
      </li>
    </ul>
     

    <div class="container my-5">
      <div class="row">
        <div class="col-md-6 offset-md-3 text-center">
          <a href="https://jhrespicio.github.io/IIS/">
            <h4 class="font-weight-light">
              <u>IIS</u>
            </h4>
          </a>

          <h1 class="mb-4">Download Votes</h1>

          <div class="text-left">
            <form>
              <div class="form-group">
                <label for="formGroupExampleInput">Public key</label>
                <input
                  type="text"
                  class="form-control"
                  id="publicKey"
                  placeholder="G"
                  required
                />
              </div>

              <input
                id="downloadButton"
                type="button"
                class="btn btn-primary"
                onclick="downloadVotes()"
                value="Download"
              />
            </form>

            <div id="spinner" class="spinner-border mt-3 d-none" role="status">
              <span class="sr-only">Loading...</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Optional JavaScript; choose one of the two! -->

    <!-- Option 1: jQuery and Bootstrap Bundle (includes Popper) -->
    <script
      src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
      integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx"
      crossorigin="anonymous"
    ></script>

    <!-- Option 2: jQuery, Popper.js, and Bootstrap JS
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" integrity="sha384-w1Q4orYjBQndcko6MimVbzY0tgp4pWB4lZ7lr30WKz0vr/aWKhXdBNmNb5D92v7s" crossorigin="anonymous"></script>
    -->
  </body>
</html>
